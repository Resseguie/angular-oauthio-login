"use strict";angular.module("resseguie.angular-oauthio-login",[]).factory("drrOauthioLogin",["$q",function($q){var self={initialize:function(key){OAuth.initialize(key)},login:function(provider){provider=provider.toLowerCase();var deferred=$q.defer();return OAuth.popup(provider,function(err,res){if(err)deferred.reject(err);else{var result={};result.endpoint=res,res.me(["name","alias","email","bio","avatar"]).done(function(data){result.user=data,deferred.resolve(result)})}}),deferred.promise}};return self}]).directive("drrOauthioLogin",["drrOauthioLogin",function(oauthioLogin){return{restrict:"EA",template:'<div class="oauthio-login"><button class="btn btn-s btn-primary" ng-click="login()"><i class="fa fa-{{providerIcon | lowercase}}" style="margin-right: 5px;"></i> Connect with {{oauthProvider}}</button></div>',scope:{onLogin:"&",oauthioKey:"@",oauthProvider:"@",providerIcon:"@"},link:function(scope,element,attrs){attrs.$observe("providerIcon",function(value){value||(scope.providerIcon=scope.oauthProvider.toLowerCase())}),scope.login=function(){if(scope.oauthioKey){oauthioLogin.initialize(scope.oauthioKey);var promise=oauthioLogin.login(scope.oauthProvider);promise.then(function(result){var oauthUser={};oauthUser.endpoint=result.endpoint,oauthUser.user=result.user,oauthUser.provider=scope.oauthProvider,oauthUser.error=null,scope.onLogin(oauthUser)},function(error){var oauthUser={};oauthUser.endpoint=null,oauthUser.user=null,oauthUser.error=error,oauthUser.provider=scope.oauthProvider,scope.oauthUser=oauthUser,scope.onLogin(oauthUser)})}}}}}]);