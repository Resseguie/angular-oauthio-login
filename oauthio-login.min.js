"use strict";angular.module("resseguie.angular-oauthio-login",[]).factory("drrOauthioLogin",["$q",function($q){var providerAPI={twitter:"/1.1/account/verify_credentials.json",facebook:"/me",github:"/user"},self={initialize:function(key){OAuth.initialize(key)},login:function(provider){var deferred=$q.defer();return OAuth.popup(provider,function(err,res){if(err)deferred.reject(err);else{var result={};result.endpoint=res;var api=providerAPI[provider];api?res.get(api).then(function(data){result.user=data,deferred.resolve(result)}):deferred.resolve(result)}}),deferred.promise},knownProvider:function(provider){var valid=providerAPI.hasOwnProperty(provider);return valid}};return self}]).directive("drrOauthioLogin",["drrOauthioLogin",function(oauthioLogin){return{restrict:"EA",template:'<div class="oauthio-login"><button class="btn btn-xs" ng-click="login()"><div  ng-show="oauthProvider==\'twitter\'"><img src="https://oauth.io/api/providers/twitter/logo" /> Connect with Twitter</div><div  ng-show="oauthProvider==\'facebook\'"><img src="https://oauth.io/api/providers/facebook/logo" /> Connect with Facebook</div><div  ng-show="oauthProvider==\'github\'"><img src="https://oauth.io/api/providers/github/logo" /> Connect with GitHub</div><div  ng-show="!knownProvider(oauthProvider)">Connect with {{oauthProvider}}</div></button></div>',scope:{oauthUser:"=",oauthioKey:"@",oauthProvider:"@"},link:function(scope){scope.knownProvider=function(provider){return oauthioLogin.knownProvider(provider)},scope.login=function(){if(scope.oauthioKey){oauthioLogin.initialize(scope.oauthioKey);var promise=oauthioLogin.login(scope.oauthProvider);promise.then(function(result){var oauthUser={};oauthUser.endpoint=result.endpoint,oauthUser.user=result.user,oauthUser.error=null,scope.oauthUser=oauthUser},function(error){var oauthUser={};oauthUser.endpoint=null,oauthUser.user=null,oauthUser.error=error,scope.oauthUser=oauthUser})}}}}}]);